"use strict";var nunjucks=require("nunjucks"),env=new nunjucks.Environment,pathFn=require("path"),fs=require("fs");env.addFilter("noControlChars",function(e){return e&&e.replace(/[\x00-\x1F\x7F]/g,"")}),env.addFilter("cdata",function(e){return e?"<![CDATA["+e.trim().replace(/\r?\n|\r/g," ").replace(/\s+/g," ")+"]]>":""}),env.addFilter("uriencode",function(e){return encodeURI(e)});var searchTmplSrc=pathFn.join(__dirname,"../templates/search.xml"),searchTmpl=nunjucks.compile(fs.readFileSync(searchTmplSrc,"utf8"),env);module.exports=function(e){var r,n,t,a=this.config,s=a.search,c=searchTmpl,i=s.field.trim(),o=s.format.trim(),u=s.limit,p=s.content;null==p&&(p=!0),""==i||"post"==i?r=e.posts.sort("-date"):n=("page"==i||(r=e.posts.sort("-date")),e.pages),""!=o&&-1<["raw","excerpt","more"].indexOf(o)&&(t=o),r=r.slice(0,u);var l=c.render({config:a,posts:r,pages:n,raw:t,content:p});return{path:s.path,data:l}};